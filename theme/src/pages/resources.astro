---
import Layout from '../layouts/Page.astro';
import HeroSection from '../components/heros/HeroSection.astro';
import resourceContent from '../../public/cms/resources.json';
import CtaGeneral from '../components/CtaGeneral.astro';
import CustomerQuoteSection from '../components/sections/CustomerQuoteSection.astro';
import { Resource } from '../models/resource';
import YouTubeEmbed from '../components/core/YouTubeEmbed.astro';
import Button from '../components/buttons/Button.astro';
import Icon from '../components/Icon.astro';
import Container from '../components/Container.astro';

//const resourceLinks = await Astro.glob<Resource>('../../public/cms/ResourceLinks/*.json');

const seo = {
	title: 'Resources | Empowered Healing Counseling - Meaghan Trezza, LMHC',
	description: 'Resources and links for depression anxiety and drama. Meaghan Trezza, LMHC, is a Somatic Experiencing Practitioner in Tacoma, WA.',
};

const resources =  await Astro.glob<Resource>('../../public/cms/ResourceLinks/*.json');


---

<Layout {seo}>
	<HeroSection>
		<div slot="text-container">
			<h1>Resources</h1>
		</div>
		<picture slot="image-container">
			<img
				width="828"
				height="414"
                id="resources-hero"
				src="/assets/images/helpful-resources.webp"
				alt="Helpful resources for depression, anxiety, and trauma"
				loading="eager"
			/>
		</picture>
	</HeroSection>

	<CustomerQuoteSection
		quoteText={resourceContent.quote}
		customerName={resourceContent.quoteAuthor}
	/>

    <Container>
        <div class="resources-grid">
            {
                resources.map((resource: Resource) => {
                    const isVideo = resource.resourceLink.includes('youtube') || resource.youtubeLink;
                    return (
                        <article class={`resource-card ${isVideo ? 'resource-card--video' : 'resource-card--link'}`}>
                            <div class="resource-card__media">
                                {isVideo ? (
                                    <YouTubeEmbed url={resource.resourceLink} />
                                ) : (
                                    <div class="resource-card__icon-placeholder">
										<Icon name="line-md:link" width="56" height="56" />
                                    </div>
                                )}
                            </div>
                            <div class="resource-card__content">
                                <div class="resource-card__header">
                                    <span class={`resource-type ${isVideo ? 'video' : 'link'}`}>
                                        {isVideo ? 'Video' : 'Article / Website'}
                                    </span>
                                    <h3>{resource.title}</h3>
                                </div>
                                <p>{resource.description}</p>
                                <div class="resource-card__footer">
                                    <Button href={resource.resourceLink} target="_blank" unelevated customIcon newTab>
                                        {isVideo ? 'Watch Video' : 'Visit Resource'}
                                        <Fragment slot="icon">
												<Icon name={isVideo ? "line-md:external-link-rounded" : "line-md:external-link-rounded"} width="20" height="20"/>
                                        </Fragment>
                                    </Button>
                                </div>
                            </div>
                        </article>
                    )
                })
            }
        </div>
    </Container>
       
	<CtaGeneral />
</Layout>

<style>
    .resources-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 1rem;
        margin: var(--section-margin) auto;
        max-width: 1040px;
    }

    .resource-card {
        background: var(--theme-surface-1);
        border-radius: calc(var(--theme-shape-radius) * 1.25);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        border: 1px solid rgba(0, 0, 0, 0.06);
        height: 100%;
        position: relative;
    }

    .resource-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, rgba(var(--theme-primary-rgb), 0.7), rgba(var(--theme-primary-rgb), 0.15));
        opacity: 0.75;
    }

    .resource-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 18px 45px rgba(0, 0, 0, 0.12);
    }

    .resource-card__media {
        background-color: var(--theme-surface-3);
        background-image: linear-gradient(
            135deg,
            rgba(var(--theme-primary-rgb), 0.18),
            rgba(var(--theme-primary-rgb), 0.05)
        );
        aspect-ratio: 16 / 9;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }

    /* Subtle layered background for a parallax-like feel */
    .resource-card__media::before {
        content: '';
        position: absolute;
        inset: -12%;
        background:
            radial-gradient(circle at 15% 15%, rgba(var(--theme-primary-rgb), 0.16), transparent 55%),
            radial-gradient(circle at 85% 40%, rgba(var(--theme-primary-rgb), 0.10), transparent 60%),
            linear-gradient(135deg, rgba(var(--theme-primary-rgb), 0.06), transparent 55%);
        transform: translate3d(0, 0, 0) scale(1.05);
        transition: transform 0.35s ease, opacity 0.35s ease;
        opacity: 0.85;
        pointer-events: none;
    }

    .resource-card__media::after {
        content: '';
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at top right, rgba(var(--theme-primary-rgb), 0.12), transparent 55%);
        pointer-events: none;
        opacity: 0.9;
    }


    
    /* Override YouTube embed styles to fit card */
    .resource-card__media :global(.youtube-embed__container) {
        width: 100%;
        margin-bottom: 0;
        border-radius: 0;
        height: 100%;
        aspect-ratio: 16/9;
        position: relative;
        z-index: 1;
    }
    .resource-card__icon-placeholder {
        padding: 1.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        position: relative;
        z-index: 1;
    }

    .resource-card__icon-placeholder :global(iconify-icon) {
        color: white;
        opacity: 0.95;
        display: block;
        width: 2.75rem;
        height: 2.75rem;
    }

    .resource-card__footer :global(iconify-icon) {
        display: block;
    }

    .resource-card__content {
        padding: 1.1rem 1.25rem 1.25rem 1.25rem;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        gap: 0.75rem;
    }

    .resource-card__header {
        margin-bottom: 0;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .resource-type {
        display: inline-block;
        width: fit-content;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        margin-bottom: 0;
        border: 1px solid rgba(var(--theme-primary-rgb), 0.18);
    }

    .resource-type.video {
        background: rgba(var(--theme-primary-rgb), 0.12);
        color: var(--theme-primary);
    }

    .resource-type.link {
        background: rgba(var(--theme-primary-rgb), 0.07);
        color: var(--theme-on-surface-1);
    }

    .resource-card h3 {
        font-size: 1.2rem;
        margin: 0;
        line-height: 1.3;
        color: var(--theme-on-surface);
        font-weight: 600;
    }

    .resource-card p {
        color: var(--theme-on-surface-1);
        line-height: 1.6;
        margin: 0;
        flex-grow: 1;
        font-size: 1rem;
    }

    .resource-card__footer {
        margin-top: auto;
        padding-top: 0.25rem;
    }

    /* CSS-only subtle "parallax" on hover: layers move at different rates */
    .resource-card:hover .resource-card__media::before {
        transform: translate3d(0, -10px, 0) scale(1.08);
        opacity: 0.95;
    }





    @media (max-width: 900px) {
        .resources-grid {
            grid-template-columns: 1fr;
        }

        .resource-card__content {
            padding: 1.25rem;
        }
    }

    @media (prefers-reduced-motion: reduce) {
        .resource-card,
        .resource-card__media::before {
            transition: none !important;
        }

        .resource-card:hover .resource-card__media::before {
            transform: none !important;
        }
    }

    /* Page-specific: make hero image feel larger */
    :global(#resources-hero) {
        height: clamp(320px, 42vw, 600px);
        max-height: none;
    }
</style>
